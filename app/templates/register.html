<!doctype html>
<html lang="en">
  <!--begin::Head-->
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Affinity Trades | CRM</title>
    <!--begin::Primary Meta Tags-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="title" content="Affinity Trades | CRM" />
    <meta name="author" content="ColorlibHQ" />
    <meta
      name="description"
      content="Affinity Trades is a trading company"
    />
    <meta
      name="keywords"
      content=""
    />
    <!--end::Primary Meta Tags-->
    <!--begin::Fonts-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@fontsource/source-sans-3@5.0.12/index.css"
      integrity="sha256-tXJfXfp6Ewt1ilPzLDtQnJV4hclT9XuaZUKyUvmyr+Q="
      crossorigin="anonymous"
    />
    <!--end::Fonts-->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/styles/overlayscrollbars.min.css"
      integrity="sha256-tZHrRjVqNSRyWg2wbppGnT833E/Ys0DHWGwT04GiqQg="
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(OverlayScrollbars)-->
    <!--begin::Third Party Plugin(Bootstrap Icons)-->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      integrity="sha256-9kPW/n5nn53j4WMRYAxe9c1rCY96Oogo/MKSVdKzPmI="
      crossorigin="anonymous"
    />
    <!--end::Third Party Plugin(Bootstrap Icons)-->
    <!--begin::Required Plugin(AdminLTE)-->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/adminlte.css') }}" />
    <!--end::Required Plugin(AdminLTE)-->
    <script>
        // Generate a basic fingerprint
        function generateFingerprint() {
            const userAgent = navigator.userAgent;
            const screenWidth = screen.width;
            const screenHeight = screen.height;
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

            const fingerprint = btoa(
                JSON.stringify({
                    user_agent: userAgent,
                    screen_width: screenWidth,
                    screen_height: screenHeight,
                    timezone: timezone,
                })
            );
            document.getElementById('device_fingerprint').value = fingerprint;
            console.log(fingerprint);
        }

        // Call the function on page load
        window.onload = generateFingerprint;
    </script>
  </head>
  <!--end::Head-->
  <!--begin::Body-->
  <body class="login-page bg-body-secondary">

    <!--begin::Col-->
              <div class="col-md-6">
      <div class="login-logo mb-4">
        <img src="../static/assets/img/aff_logo.svg" alt="Logo" />
      </div>

      <form id="registrationForm" action="/register/client" method="post" novalidate>
        <div class="card card-success card-outline mb-4">
          <!--begin::Header-->
          <div class="card-header">
            <div class="card-title">Enter Your Details Below</div>
          </div>
          <!--end::Header-->

          <!--begin::Body-->
          <div class="card-body">
            <!-- Email -->
            <div class="input-group mb-3">
              <span class="input-group-text"><span class="bi bi-envelope"></span></span>
              <input
                type="email"
                class="form-control"
                id="email"
                name="email"
                placeholder="Email"
                aria-label="Email"
                required
              />
            </div>

            <!-- Password -->
            <div class="input-group mb-3">
              <span class="input-group-text"><span class="bi bi-lock"></span></span>
              <input
                type="password"
                class="form-control"
                id="password"
                name="password"
                placeholder="Password"
                aria-label="Password"
                required
              />
            </div>

            <!-- Re-enter Password & Password Criteria -->
            <div class="mb-3">
              <div class="input-group">
                <span class="input-group-text"><span class="bi bi-lock"></span></span>
                <input
                  type="password"
                  class="form-control"
                  id="RePassword"
                  name="RePassword"
                  placeholder="Re-enter Password"
                  aria-label="RePassword"
                  required
                />
              </div>

              <div class="form-text" id="password-validation">
                <ul class="mb-0">
                  <li id="8characters" class="text-secondary">8 Characters</li>
                  <li id="1UpperCase" class="text-secondary">1 Upper-Case Letter</li>
                  <li id="1LowerCase" class="text-secondary">1 lower-case Letter</li>
                  <li id="1Number" class="text-secondary">1 Number</li>
                  <li id="1SpecialCharacter" class="text-secondary">
                    1 special character: !@#$%^&*()-_}{.+\|/
                  </li>
                </ul>
              </div>
            </div>

            <!-- First Name -->
            <div class="input-group mb-3">
              <span class="input-group-text"><span class="bi bi-person"></span></span>
              <input
                type="text"
                class="form-control"
                id="firstName"
                name="firstName"
                placeholder="First Name"
                aria-label="firstName"
                required
              />
            </div>

            <!-- Last Name -->
            <div class="input-group mb-3">
              <span class="input-group-text"><span class="bi bi-person"></span></span>
              <input
                type="text"
                class="form-control"
                id="lastName"
                name="lastName"
                placeholder="Last Name"
                aria-label="lastName"
                required
              />
            </div>

            <!-- Birth Date -->
            <div class="input-group mb-3">
              <div class="input-group-text">
                <span>Birth Date</span>
              </div>
              <input
                type="date"
                id="birthDate"
                name="birthDate"
                class="form-control"
                required
              />
            </div>

            <!-- Country Code & Mobile Number -->
            <div class="input-group mb-3">
              <select
                class="form-control"
                id="countryCode"
                name="countryCode"
                required
              >
                <option value="+91">(+91) India</option>
                <!-- You can add more country codes here if needed -->
              </select>

              <span class="input-group-text">-</span>
              <input
                type="tel"
                class="form-control"
                id="mobileNumber"
                name="mobileNumber"
                pattern="^\d{10}$"
                placeholder="Enter 10 digits"
                required
                title="Please enter exactly 10 digits."
                maxlength="10"
              />
            </div>
             <div class="input-group mb-3">
             <input type="text" value="{{ ref_data.refID if ref_data.refID else '' }}" id="refId" name="refId" class="form-control" />

               <button type="button" id="btnValidateRef" name="btnValidateRef" class="btn btn-warning">Validate -></button>
              <input type="text" id="refNameCheck" name="refNameCheck" class="form-control" disabled/>
            </div>
            <div class="mb-3">
              <div class="form-text">
                Please validate Referral Code above and click on Validate. Leave it empty if you have no referral.
              </div>
            </div>
            <input type="hidden" id="device_fingerprint" name="device_fingerprint">

            <!-- Checkboxes -->
            <div class="form-check mb-2">
              <input
                class="form-check-input"
                type="checkbox"
                id="chckAdult"
                name="chckAdult"
                required
              />
              <label class="form-check-label" for="chckAdult">
                I am an Adult
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="checkbox"
                id="chckCountries"
                name="chckCountries"
                required
              />
              <label class="form-check-label" for="chckCountries">
                I am not US, Iran or North Korea resident
              </label>
            </div>
          </div>
          <!--end::Body-->

          <!--begin::Footer-->
          <div class="card-footer">
            <button
              type="submit"
              class="btn btn-success"
              disabled
            >
              Submit
            </button>
          </div>
          <!--end::Footer-->
        </div>
      </form>
    </div>
              <!--end::Col-->
    <!-- /.login-box -->
    <!--begin::Third Party Plugin(OverlayScrollbars)-->
    <script
      src="https://cdn.jsdelivr.net/npm/overlayscrollbars@2.10.1/browser/overlayscrollbars.browser.es6.min.js"
      integrity="sha256-dghWARbRe2eLlIJ56wNB+b760ywulqK3DzZYEpsg2fQ="
      crossorigin="anonymous"
    ></script>
    <!--end::Third Party Plugin(OverlayScrollbars)--><!--begin::Required Plugin(popperjs for Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(popperjs for Bootstrap 5)--><!--begin::Required Plugin(Bootstrap 5)-->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>
    <!--end::Required Plugin(Bootstrap 5)--><!--begin::Required Plugin(AdminLTE)-->
    <script src="{{ url_for('static', filename='js/adminlte.js') }}"></script>
    <!--end::Required Plugin(AdminLTE)--><!--begin::OverlayScrollbars Configure-->
    <script>
      const SELECTOR_SIDEBAR_WRAPPER = '.sidebar-wrapper';
      const Default = {
        scrollbarTheme: 'os-theme-light',
        scrollbarAutoHide: 'leave',
        scrollbarClickScroll: true,
      };
      document.addEventListener('DOMContentLoaded', function () {
        const sidebarWrapper = document.querySelector(SELECTOR_SIDEBAR_WRAPPER);
        if (sidebarWrapper && typeof OverlayScrollbarsGlobal?.OverlayScrollbars !== 'undefined') {
          OverlayScrollbarsGlobal.OverlayScrollbars(sidebarWrapper, {
            scrollbars: {
              theme: Default.scrollbarTheme,
              autoHide: Default.scrollbarAutoHide,
              clickScroll: Default.scrollbarClickScroll,
            },
          });
        }
      });
    </script>
    <script>
  // Adjust the path to where your countryCodes.json is located
  const countryCodesJsonPath = '/static/CountryCodes.json';

  fetch(countryCodesJsonPath)
    .then(response => response.json())
    .then(data => {
      const selectElem = document.getElementById('countryCode');

      data.forEach(country => {
        // Create an <option> element
        const option = document.createElement('option');
        // Set the value to the dial_code
        option.value = country.dial_code;
        // Display text as (dial_code) name, e.g. "(+91) India"
        option.textContent = `(${country.dial_code}) ${country.name}`;
        // Append <option> to the <select>
        selectElem.appendChild(option);
      });
    })
    .catch(error => {
      console.error('Error fetching country codes:', error);
    });
</script>
    <script>
  // --- Selectors ---
  const form = document.getElementById('registrationForm');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const rePasswordInput = document.getElementById('RePassword');
  const firstNameInput = document.getElementById('firstName');
  const lastNameInput = document.getElementById('lastName');
  const birthDateInput = document.getElementById('birthDate');
  const countryCodeSelect = document.getElementById('countryCode');
  const mobileNumberInput = document.getElementById('mobileNumber');
  const chckAdult = document.getElementById('chckAdult');
  const chckCountries = document.getElementById('chckCountries');
  const submitBtn = form.querySelector('button[type="submit"]');

  // Password criteria list items
  const li8characters = document.getElementById('8characters');
  const liUpperCase = document.getElementById('1UpperCase');
  const liLowerCase = document.getElementById('1LowerCase');
  const liNumber = document.getElementById('1Number');
  const liSpecialChar = document.getElementById('1SpecialCharacter');

  // --- Event Listeners ---
  // We listen for 'input' on the entire form, so any change triggers re-validation
  form.addEventListener('input', validateForm);

  // --- Validation Function ---
  function validateForm() {
    // Check password criteria
    const passwordValue = passwordInput.value;
    const rePasswordValue = rePasswordInput.value;

    const has8Chars = passwordValue.length >= 8;
    const hasUpperCase = /[A-Z]/.test(passwordValue);
    const hasLowerCase = /[a-z]/.test(passwordValue);
    const hasNumber = /[0-9]/.test(passwordValue);
    // Allowed special characters: !@#$%^&*()-_}{.+\|/
    const specialCharRegex = /[!@#$%^&*()\-_}{.+|/\\]/;
    const hasSpecialChar = specialCharRegex.test(passwordValue);

    // Update each criteria <li>
    updateCriteriaUI(li8characters, has8Chars);
    updateCriteriaUI(liUpperCase, hasUpperCase);
    updateCriteriaUI(liLowerCase, hasLowerCase);
    updateCriteriaUI(liNumber, hasNumber);
    updateCriteriaUI(liSpecialChar, hasSpecialChar);

    // Check if both password fields match
    const passwordsMatch = passwordValue && (passwordValue === rePasswordValue);

    // We can do a quick check for standard HTML validity (required fields, patterns, etc.)
    // However, the password matching is a custom check, so we handle that manually.
    let formIsValid = form.checkValidity();

    // If the form is otherwise valid, also ensure password meets all criteria & matches RePassword
    if (formIsValid) {
      // All password rules + password match
      const allPasswordRules =
        has8Chars && hasUpperCase && hasLowerCase && hasNumber && hasSpecialChar;

      // If password does not meet all rules or doesn't match, override
      if (!allPasswordRules || !passwordsMatch) {
        formIsValid = false;
      }
    }

    // Finally, enable or disable the submit button
    submitBtn.disabled = !formIsValid;
  }

  // --- Helper to update each <li> to .text-success or .text-danger (and remove .text-secondary) ---
  function updateCriteriaUI(element, conditionMet) {
    if (!passwordInput.value) {
      // If password is empty, keep them all text-secondary
      element.classList.remove('text-success', 'text-danger');
      element.classList.add('text-secondary');
    } else {
      if (conditionMet) {
        element.classList.remove('text-secondary', 'text-danger');
        element.classList.add('text-success');
      } else {
        element.classList.remove('text-secondary', 'text-success');
        element.classList.add('text-danger');
      }
    }
  }
</script>
    <!--end::OverlayScrollbars Configure-->
    <!--end::Script-->
  </body>
  <!--end::Body-->
</html>
